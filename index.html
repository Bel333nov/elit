<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NAVI‚Ä¢ESTATE ‚Äî –ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font close to BI style: Manrope + Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --pad: 10px;
      --r-xl: 28px;
      --r-lg: 22px;
    }

    /* ‚úÖ BACKGROUND like your 1st screenshot (cool light grey, more contrast vs white cards) */
    body{
      font-family: "Manrope","Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:#0f172a;
      background:
        radial-gradient(900px 520px at 20% -10%, rgba(255,255,255,0.55) 0%, rgba(255,255,255,0) 62%),
        radial-gradient(760px 520px at 90% 0%, rgba(255,255,255,0.45) 0%, rgba(255,255,255,0) 58%),
        linear-gradient(180deg, #EEF2F7 0%, #E9EEF5 55%, #E7ECF3 100%);
    }

    /* ‚úÖ make layout more "tight": limit width + center */
    .container-wide{
      width:100%;
      max-width: 1400px;   /* –º–æ–∂–Ω–æ 1320px –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –µ—â—ë –ø–ª–æ—Ç–Ω–µ–µ */
      margin: 0 auto;
      padding:0 var(--pad);
    }

    .hairline{ border-color: rgba(15,23,42,0.10); }

    /* Glass */
    .glass{
      background: rgba(255,255,255,0.62);
      border: 1px solid rgba(255,255,255,0.22);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 12px 26px rgba(15,23,42,0.10);
    }
    .glass-dark{
      background: rgba(2,6,23,0.36);
      border: 1px solid rgba(255,255,255,0.14);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    /* ‚úÖ HERO background (—á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å ‚Äî 100% —Å—Ä–∞–±–æ—Ç–∞–µ—Ç) */
    .hero-bg{
      background-image: url("/images/hero.jpg"); /* <-- –ø–æ–º–µ–Ω—è–π, –µ—Å–ª–∏ —Ñ–∞–π–ª –∏–Ω–∞—á–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    /* ‚úÖ Hero overlay ‚Äî —É—Å–∏–ª–∏–ª–∏, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç —á–∏—Ç–∞–ª—Å—è */
    .hero-overlay{
      background:
        linear-gradient(180deg,
          rgba(2,6,23,0.48) 0%,
          rgba(2,6,23,0.78) 60%,
          rgba(2,6,23,0.55) 100%);
    }

    @media (max-width: 768px){
      .hero-bg{ background-position: center top; }
    }

    .hero-title{
      font-size: clamp(18px, 2.6vw, 36px);
      line-height: 1.06;
      letter-spacing: -0.04em;
      font-weight: 800;
      color: #fff;
      text-shadow: 0 10px 30px rgba(2,6,23,0.55);
      max-width: 900px;
      margin: 0 auto;
      text-align: center;
    }

    .hero-seo{
      margin-top: 10px;
      max-width: 860px;
      margin-left: auto;
      margin-right: auto;
      text-align: center;
      font-size: 12px;
      line-height: 1.5;
      color: rgba(255,255,255,0.70);
      font-weight: 600;
      text-shadow: 0 10px 30px rgba(2,6,23,0.45);
    }

    /* Header spacing */
    .header-inner{ max-width: 1400px; margin: 0 auto; padding: 0 var(--pad); }

    /* ===== Cards (BI-like LIGHT style, no black cards) ===== */
    .listing-card{
      border-radius: 22px;
      background: #ffffff;
      border: 1px solid rgba(15,23,42,0.08);
      box-shadow: 0 14px 30px rgba(15,23,42,0.06);
      overflow:hidden;
      display:flex;
      flex-direction: column;
      min-height: 100%;
    }

    .listing-media{
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      margin: 12px 12px 0 12px;
      background: #e5e7eb;
      isolation: isolate;
    }
    .listing-media img{
      width: 100%;
      height: 196px;
      object-fit: cover;
      display:block;
      transform: translateZ(0);
    }
    .listing-media::after{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(2,6,23,0.00) 55%, rgba(2,6,23,0.10) 100%);
      pointer-events:none;
    }

    .badge{
      position:absolute;
      top: 10px;
      left: 10px;
      z-index: 2;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      font-weight: 800;
      line-height: 1;
      color:#fff;
      background: rgba(30,41,59,0.92);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      box-shadow: 0 10px 18px rgba(2,6,23,0.20);
    }

    .listing-body{
      padding: 12px;
      display:flex;
      flex-direction: column;
      gap: 6px;
      flex: 1;
    }

    .listing-title{
      font-size: 20px;
      font-weight: 900;
      letter-spacing: -0.02em;
      color: #0b1220;
      line-height: 1.18;
      margin-top: 2px;
    }
    @media (max-width: 768px){
      .listing-title{ font-size: 18px; }
    }

    .listing-sub{
      font-size: 12px;
      font-weight: 500;
      color: rgba(15,23,42,0.62);
      display:flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 0px;
    }
    .listing-sub .dot{
      color: rgba(15,23,42,0.28);
      font-weight: 500;
    }

    .listing-price{
      font-size: 14px;
      font-weight: 600;
      color: #2563eb;
      margin-top: 0px;
    }

    .listing-meta{
      margin-top: 6px;
      border-top: 1px solid rgba(15,23,42,0.08);
      padding-top: 8px;
      display:flex;
      flex-wrap: wrap;
      align-items:center;
      gap: 10px;
      font-size: 12px;
      font-weight: 500;
      color: rgba(15,23,42,0.78);
    }
    .listing-meta .item{
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      font-weight: 500;
    }
    .listing-meta .divider{
      color: rgba(15,23,42,0.28);
      font-weight: 500;
    }

    .listing-actions{
      padding: 8px 12px 12px 12px;
      margin-top: -2px;
    }
    .btn-more{
      width: 100%;
      height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(15,23,42,0.14);
      background: #fff;
      font-size: 14px;
      font-weight: 600;
      color: rgba(15,23,42,0.82);
      transition: 150ms ease;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .btn-more:hover{
      background: rgba(15,23,42,0.03);
    }

    .grid-banner{
      border-radius: 22px;
      position: relative;
      overflow:hidden;
      border: 1px solid rgba(15,23,42,0.10);
      box-shadow: 0 16px 36px rgba(15,23,42,0.08);
      min-height: 320px;
      background: linear-gradient(135deg, rgba(15,23,42,0.08) 0%, rgba(15,23,42,0.03) 100%);
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 24px;
    }
    .grid-banner::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(520px 280px at 20% 30%, rgba(59,130,246,0.18) 0%, rgba(2,6,23,0) 60%),
        radial-gradient(520px 280px at 80% 20%, rgba(99,102,241,0.14) 0%, rgba(2,6,23,0) 60%),
        linear-gradient(180deg, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0.10) 100%);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      pointer-events:none;
    }
    .grid-banner .pill{
      position: relative;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 12px 16px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 900;
      color: rgba(15,23,42,0.86);
      background: rgba(255,255,255,0.55);
      border: 1px solid rgba(255,255,255,0.22);
      box-shadow: 0 12px 24px rgba(15,23,42,0.10);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }
    .grid-banner .sub{
      position: relative;
      margin-top: 10px;
      font-size: 12px;
      font-weight: 900;
      color: rgba(15,23,42,0.55);
    }
  </style>
</head>

<body>

<header class="sticky top-0 z-50 bg-white/85 backdrop-blur border-b hairline">
  <div class="header-inner">
    <div class="flex items-center justify-between py-4">
      <div class="flex items-center gap-10">
        <a href="#" class="text-lg font-extrabold tracking-tight text-slate-900">NAVI‚Ä¢ESTATE</a>
        <nav class="hidden md:flex items-center gap-6 text-sm font-semibold">
          <a class="text-slate-700 hover:text-slate-900 transition" href="#">–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏</a>
          <a class="text-slate-700 hover:text-slate-900 transition" href="#">–†–∞–π–æ–Ω—ã</a>
          <a class="text-slate-700 hover:text-slate-900 transition" href="#">–ó–∞—Å—Ç—Ä–æ–π—â–∏–∫–∏</a>
          <a class="text-slate-700 hover:text-slate-900 transition" href="#">–ê–∫—Ü–∏–∏</a>
          <a class="text-slate-700 hover:text-slate-900 transition" href="#">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        </nav>
      </div>

      <div class="flex items-center gap-3">
        <button class="hidden sm:inline-flex items-center justify-center h-11 w-11 rounded-full border hairline bg-white hover:bg-slate-50 transition">‚ù§</button>
        <button class="h-11 px-5 rounded-xl bg-slate-900 text-white text-sm font-semibold hover:bg-slate-800 transition">
          –ü–æ–¥–æ–±—Ä–∞—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É
        </button>
      </div>
    </div>
  </div>
</header>

<main class="container-wide">

  <!-- HERO -->
  <section class="mt-4">
    <div class="relative overflow-hidden rounded-[28px] border hairline">

      <!-- ‚úÖ –ò–ó–ú–ï–ù–ï–ù–û: —Ç–µ–ø–µ—Ä—å —Ñ–æ–Ω –∑–∞–¥–∞—ë—Ç—Å—è –∫–ª–∞—Å—Å–æ–º hero-bg -->
      <div class="absolute inset-0 hero-bg"></div>

      <div class="absolute inset-0 hero-overlay"></div>

      <div class="absolute top-4 left-4 z-20">
        <button class="inline-flex items-center gap-2 px-4 py-2 rounded-xl glass-dark text-white text-sm font-semibold">
          üìç –ë–∏—à–∫–µ–∫
        </button>
      </div>

      <div class="relative z-10 px-6 md:px-12 py-10 md:py-12">
        <h1 class="hero-title">–ü–æ–∏—Å–∫ –ø—Ä–µ–º–∏–∞–ª—å–Ω–æ–π –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</h1>

        <div class="hero-seo">
          –ü–æ–¥–±–æ—Ä –Ω–æ–≤–æ—Å—Ç—Ä–æ–µ–∫ –≤ –ë–∏—à–∫–µ–∫–µ, –û—à–µ –∏ –Ω–∞ –´—Å—Å—ã–∫-–ö—É–ª–µ: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –∫–ª–∞—Å—Å—ã –ö–æ–º—Ñ–æ—Ä—Ç+ / –ë–∏–∑–Ω–µ—Å / –ü—Ä–µ–º–∏—É–º, —Ü–µ–Ω—ã –∏ —Å—Ä–æ–∫–∏ —Å–¥–∞—á–∏.
        </div>

        <!-- FILTER -->
        <div class="mt-7">
          <div class="bg-white rounded-2xl overflow-hidden border border-black/5 shadow-lg">

            <div class="grid grid-cols-1 md:grid-cols-12">

              <div class="md:col-span-2 px-4 py-4 border-b md:border-b-0 md:border-r border-slate-200">
                <label class="block text-[11px] font-semibold text-slate-500">–ì–æ—Ä–æ–¥</label>
                <select id="fCity" class="mt-1 w-full outline-none text-sm font-semibold text-slate-800 bg-transparent">
                  <option value="">–õ—é–±–æ–π</option>
                </select>
              </div>

              <div class="md:col-span-2 px-4 py-4 border-b md:border-b-0 md:border-r border-slate-200">
                <label class="block text-[11px] font-semibold text-slate-500">–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</label>
                <select id="fType" class="mt-1 w-full outline-none text-sm font-semibold text-slate-800 bg-transparent">
                  <option value="" selected>–õ—é–±–æ–π</option>
                  <option value="–ö–≤–∞—Ä—Ç–∏—Ä—ã">–ö–≤–∞—Ä—Ç–∏—Ä—ã</option>
                  <option value="–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø–æ–º–µ—â–µ–Ω–∏—è">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø–æ–º–µ—â–µ–Ω–∏—è</option>
                  <option value="–¢–∞–Ω—Ö–∞—É—Å—ã">–¢–∞–Ω—Ö–∞—É—Å—ã</option>
                </select>
              </div>

              <div class="md:col-span-2 px-4 py-4 border-b md:border-b-0 md:border-r border-slate-200">
                <label class="block text-[11px] font-semibold text-slate-500">–ö–ª–∞—Å—Å –æ–±—ä–µ–∫—Ç–∞</label>
                <select id="fClass" class="mt-1 w-full outline-none text-sm font-semibold text-slate-800 bg-transparent">
                  <option value="">–õ—é–±–æ–π</option>
                </select>
              </div>

              <div class="md:col-span-2 px-4 py-4 border-b md:border-b-0 md:border-r border-slate-200">
                <label class="block text-[11px] font-semibold text-slate-500">–¢–æ–ø –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫–∏</label>
                <select id="fDev" class="mt-1 w-full outline-none text-sm font-semibold text-slate-800 bg-transparent">
                  <option value="">–õ—é–±–æ–π</option>
                </select>
              </div>

              <div class="md:col-span-2 px-4 py-4 border-b md:border-b-0 md:border-r border-slate-200">
                <label class="block text-[11px] font-semibold text-slate-500">–°—Ä–æ–∫ —Å–¥–∞—á–∏</label>
                <select id="fYear" class="mt-1 w-full outline-none text-sm font-semibold text-slate-800 bg-transparent">
                  <option value="">–õ—é–±–æ–π</option>
                </select>
              </div>

              <div class="md:col-span-2 px-4 py-4">
                <label class="block text-[11px] font-semibold text-slate-500">–¶–µ–Ω–∞ ($/–º¬≤)</label>
                <div class="mt-1 grid grid-cols-2 gap-3">
                  <input id="fPriceFrom" class="w-full outline-none text-sm font-semibold text-slate-800" placeholder="–æ—Ç" inputmode="numeric" />
                  <input id="fPriceTo" class="w-full outline-none text-sm font-semibold text-slate-800" placeholder="–¥–æ" inputmode="numeric" />
                </div>
              </div>
            </div>

            <div class="border-t border-slate-200">
              <div class="px-4 py-4">
                <div class="flex flex-col lg:flex-row lg:items-center gap-4">

                  <div class="flex flex-wrap gap-6">
                    <label class="inline-flex items-center gap-2 text-sm font-semibold text-slate-700">
                      <input id="fMortgage" type="checkbox" class="h-4 w-4 rounded border-slate-300" />
                      –í –∏–ø–æ—Ç–µ–∫—É
                    </label>
                    <label class="inline-flex items-center gap-2 text-sm font-semibold text-slate-700">
                      <input id="fPromo" type="checkbox" class="h-4 w-4 rounded border-slate-300" />
                      –ê–∫—Ü–∏–∏
                    </label>
                  </div>

                  <div class="lg:ml-auto flex flex-col sm:flex-row items-stretch sm:items-center gap-3">
                    <button class="h-12 px-6 rounded-xl bg-white text-slate-900 font-semibold border border-slate-200 hover:bg-slate-50 transition whitespace-nowrap">
                      –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
                    </button>
                    <button id="btnFind" class="h-12 px-8 rounded-xl bg-blue-600 text-white font-semibold hover:bg-blue-700 transition whitespace-nowrap">
                      –ù–∞–π—Ç–∏
                    </button>
                    <button id="btnReset" class="h-12 px-6 rounded-xl bg-slate-900 text-white font-semibold hover:bg-slate-800 transition whitespace-nowrap">
                      –°–±—Ä–æ—Å
                    </button>
                  </div>

                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="py-3">
    <div class="flex flex-col md:flex-row md:items-center gap-4">
      <label class="inline-flex items-center gap-3 bg-white rounded-2xl px-4 py-3 border hairline">
        <input type="checkbox" class="h-5 w-5 rounded border hairline" />
        <span class="text-sm font-semibold text-slate-800">–°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ –±–∏–≥–≤–∏–ª–ª—è–º</span>
      </label>

      <div class="flex-1 bg-white rounded-2xl px-4 py-3 border hairline flex items-center gap-3">
        <span class="text-slate-400">üîé</span>
        <input id="fSearch" class="w-full outline-none text-sm" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é / –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫—É" />
      </div>
    </div>
  </section>

  <section class="pb-8">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-extrabold text-slate-900">–û–±—ä–µ–∫—Ç—ã –∏–∑ –±–∞–∑—ã</h2>
      <div id="airtableStatus" class="text-sm text-slate-500">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
    </div>

    <div id="airtableGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-5"></div>
  </section>

  <script>
    (function () {
      const grid = document.getElementById("airtableGrid");
      const statusEl = document.getElementById("airtableStatus");

      const elCity = document.getElementById("fCity");
      const elClass = document.getElementById("fClass");
      const elDev = document.getElementById("fDev");
      const elYear = document.getElementById("fYear");
      const elType = document.getElementById("fType");

      const elPriceFrom = document.getElementById("fPriceFrom");
      const elPriceTo = document.getElementById("fPriceTo");
      const elSearch = document.getElementById("fSearch");

      const elMortgage = document.getElementById("fMortgage");
      const elPromo = document.getElementById("fPromo");

      const btnFind = document.getElementById("btnFind");
      const btnReset = document.getElementById("btnReset");

      let allRecords = [];

      function esc(s) {
        return String(s ?? "").replace(/[&<>"']/g, c => ({
          "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
        }[c]));
      }

      function norm(s) { return String(s ?? "").trim().toLowerCase(); }

      function getField(obj, keys) {
        for (const k of keys) {
          if (obj && obj[k] != null && obj[k] !== "") return obj[k];
        }
        return "";
      }

      function fCityValue(rec){ return getField(rec, ["city", "–ì–æ—Ä–æ–¥"]); }
      function fClassObject(rec){ return getField(rec, ["class_object", "–ö–ª–∞—Å—Å –æ–±—ä–µ–∫—Ç–∞", "class_object_text"]); }
      function fDeveloper(rec){ return getField(rec, ["developer", "–ó–∞—Å—Ç—Ä–æ–π—â–∏–∫"]); }
      function fHandover(rec){ return getField(rec, ["handover", "–°—Ä–æ–∫ —Å–¥–∞—á–∏"]); }
      function fName(rec){ return getField(rec, ["name", "–ù–∞–∑–≤–∞–Ω–∏–µ"]); }
      function fLink(rec){ return getField(rec, ["–°—Å—ã–ª–∫–∞", "link", "url"]); }
      function fPhoto(rec){ return getField(rec, ["photo_link", "photo", "image"]); }
      function fPriceM2Text(rec){ return getField(rec, ["price_m2", "–¶–µ–Ω–∞ –∑–∞ –º2"]); }
      function fAddress(rec){ return getField(rec, ["address", "–ê–¥—Ä–µ—Å", "location"]); }

      function fMortgageFlag(rec){ return getField(rec, ["mortgage", "–í –∏–ø–æ—Ç–µ–∫—É"]); }
      function fPromoFlag(rec){ return getField(rec, ["promo", "–ê–∫—Ü–∏–∏"]); }
      function fTypeValue(rec){ return getField(rec, ["type", "–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏"]); }

      function parseNumber(v) {
        const s = String(v ?? "").replace(",", ".").replace(/[^\d.]/g, "");
        if (!s) return null;
        const n = Number(s);
        return Number.isFinite(n) ? n : null;
      }

      function priceValue(rec){
        const t = fPriceM2Text(rec);
        const m = String(t || "").match(/–æ—Ç\s*([\d\s.,]+)/i);
        if (m && m[1]) {
          const n = parseNumber(m[1]);
          if (n != null) return n;
        }
        return parseNumber(t);
      }

      function extractYear(text){
        const m = String(text ?? "").match(/(20\\d{2})/);
        return m ? Number(m[1]) : null;
      }

      function truthy(v){
        const s = norm(v);
        return s === "true" || s === "1" || s === "yes" || s === "–¥–∞" || s === "–∏—Å—Ç–∏–Ω–∞" || s === "y";
      }

      function setOptions(selectEl, values, firstLabel="–õ—é–±–æ–π") {
        const current = selectEl.value;
        selectEl.innerHTML =
          `<option value="">${esc(firstLabel)}</option>` +
          values.map(v => `<option value="${esc(v)}">${esc(v)}</option>`).join("");
        if (current) {
          const exists = values.some(v => String(v) === String(current));
          if (exists) selectEl.value = current;
        }
      }

      function buildFilterOptions(records) {
        const cities = Array.from(new Set(records.map(fCityValue).filter(Boolean))).sort((a,b)=>a.localeCompare(b,"ru"));
        const classes = Array.from(new Set(records.map(fClassObject).filter(Boolean))).sort((a,b)=>a.localeCompare(b,"ru"));
        const devs = Array.from(new Set(records.map(fDeveloper).filter(Boolean))).sort((a,b)=>a.localeCompare(b,"ru"));
        const years = Array.from(new Set(records.map(r => extractYear(fHandover(r))).filter(Boolean))).sort((a,b)=>a-b).map(String);

        setOptions(elCity, cities, "–õ—é–±–æ–π");
        setOptions(elClass, classes, "–õ—é–±–æ–π");
        setOptions(elDev, devs, "–õ—é–±–æ–π");
        setOptions(elYear, years, "–õ—é–±–æ–π");
      }

      function applyFilters(records) {
        const city = elCity.value.trim();
        const cls = elClass.value.trim();
        const dev = elDev.value.trim();
        const year = elYear.value.trim();

        const pFrom = parseNumber(elPriceFrom.value);
        const pTo = parseNumber(elPriceTo.value);

        const q = norm(elSearch.value);

        const wantMortgage = !!elMortgage?.checked;
        const wantPromo = !!elPromo?.checked;

        const type = elType?.value?.trim() || "";

        return records.filter(rec => {
          if (city && norm(fCityValue(rec)) !== norm(city)) return false;
          if (cls && norm(fClassObject(rec)) !== norm(cls)) return false;
          if (dev && norm(fDeveloper(rec)) !== norm(dev)) return false;

          if (year) {
            const ry = extractYear(fHandover(rec));
            if (!ry || String(ry) !== String(year)) return false;
          }

          const pv = priceValue(rec);
          if (pFrom != null) {
            if (pv == null) return false;
            if (pv < pFrom) return false;
          }
          if (pTo != null) {
            if (pv == null) return false;
            if (pv > pTo) return false;
          }

          if (q) {
            const text = norm(`${fName(rec)} ${fDeveloper(rec)} ${fCityValue(rec)}`);
            if (!text.includes(q)) return false;
          }

          if (type) {
            const rt = norm(fTypeValue(rec));
            if (rt && rt !== norm(type)) return false;
          }

          if (wantMortgage) {
            const mv = fMortgageFlag(rec);
            if (!truthy(mv)) return false;
          }
          if (wantPromo) {
            const pv2 = fPromoFlag(rec);
            if (!truthy(pv2)) return false;
          }

          return true;
        });
      }

      function sortObjects(items) {
        return [...items].sort((a, b) => {
          const byCity = norm(fCityValue(a)).localeCompare(norm(fCityValue(b)), "ru");
          if (byCity !== 0) return byCity;

          const byClass = norm(fClassObject(a)).localeCompare(norm(fClassObject(b)), "ru");
          if (byClass !== 0) return byClass;

          const ya = extractYear(fHandover(a)) ?? 9999;
          const yb = extractYear(fHandover(b)) ?? 9999;
          if (ya !== yb) return ya - yb;

          const pa = priceValue(a);
          const pb = priceValue(b);
          if (pa == null && pb == null) return 0;
          if (pa == null) return 1;
          if (pb == null) return -1;
          return pa - pb;
        });
      }

      function bannerHTML() {
        return `
          <div class="grid-banner sm:col-span-2 lg:col-span-4">
            <div>
              <div class="pill">–†–µ–∫–ª–∞–º–Ω—ã–π –±–∞–Ω–Ω–µ—Ä</div>
              <div class="sub">–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ –ø–µ—Ä–≤—ã—Ö 4 –∫–∞—Ä—Ç–æ—á–µ–∫ –∏–∑ –±–∞–∑—ã</div>
            </div>
          </div>
        `;
      }

      function cardHTML(rec) {
        const title = fName(rec) || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
        const href = fLink(rec) || "#";
        const img = fPhoto(rec) || "hero-bg.png";
        const badge = fClassObject(rec) || "–û–±—ä–µ–∫—Ç";

        const city = fCityValue(rec) || "‚Äî";
        const dev = fDeveloper(rec) || "‚Äî";
        const handover = fHandover(rec) || "‚Äî";
        const address = fAddress(rec) || "‚Äî";

        const p = priceValue(rec);
        const priceText = (p != null) ? `–æ—Ç $${p} / –º¬≤` : (fPriceM2Text(rec) ? String(fPriceM2Text(rec)) : "‚Äî");

        return `
          <article class="listing-card">
            <div class="listing-media">
              <img src="${esc(img)}" alt="${esc(title)}" />
              <div class="badge">${esc(badge)}</div>
            </div>

            <div class="listing-body">
              <div class="listing-title">${esc(title)}</div>

              <div class="listing-sub">
                <span>–æ—Ç</span>
                <span class="dot">‚Ä¢</span>
                <span>${esc(dev)}</span>
              </div>

              <div class="listing-price">${esc(priceText)}</div>

              <div class="listing-meta" title="${esc(handover)} | ${esc(city)} | ${esc(address)}">
                <span class="item">${esc(handover)}</span>
                <span class="divider">|</span>
                <span class="item">${esc(city)}</span>
                <span class="divider">|</span>
                <span class="item">${esc(address)}</span>
              </div>
            </div>

            <div class="listing-actions">
              <a href="${esc(href)}" target="_blank" rel="noopener">
                <button class="btn-more">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
              </a>
            </div>
          </article>
        `;
      }

      function render(records) {
        const sorted = sortObjects(records);
        statusEl.textContent = `–ù–∞–π–¥–µ–Ω–æ: ${sorted.length}`;

        const first = sorted.slice(0, 4).map(cardHTML).join("");
        const rest = sorted.slice(4).map(cardHTML).join("");

        grid.innerHTML = first + (sorted.length > 4 ? bannerHTML() : "") + rest;
      }

      function refresh() {
        const filtered = applyFilters(allRecords);
        render(filtered);
      }

      function resetFilters() {
        elCity.value = "";
        elClass.value = "";
        elDev.value = "";
        elYear.value = "";
        if (elType) elType.value = "";
        elPriceFrom.value = "";
        elPriceTo.value = "";
        elSearch.value = "";
        if (elMortgage) elMortgage.checked = false;
        if (elPromo) elPromo.checked = false;
        refresh();
      }

      async function load() {
        try {
          statusEl.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶";
          const r = await fetch("/api/airtable", { cache: "no-store" });
          const data = await r.json();

          if (!r.ok) {
            statusEl.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏";
            grid.innerHTML = `<div class="text-sm text-red-600">–û—à–∏–±–∫–∞: ${esc(data?.error || "unknown")}</div>`;
            return;
          }

          const records = Array.isArray(data?.records) ? data.records : [];
          if (!records.length) {
            statusEl.textContent = "–ü—É—Å—Ç–æ";
            grid.innerHTML = `<div class="text-sm text-slate-600">–í –±–∞–∑–µ –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π.</div>`;
            return;
          }

          allRecords = records;
          buildFilterOptions(allRecords);
          refresh();

        } catch (e) {
          statusEl.textContent = "–û—à–∏–±–∫–∞";
          grid.innerHTML = `<div class="text-sm text-red-600">–û—à–∏–±–∫–∞: ${esc(e?.message || e)}</div>`;
        }
      }

      if (btnFind) btnFind.addEventListener("click", refresh);
      if (btnReset) btnReset.addEventListener("click", resetFilters);

      [elCity, elClass, elDev, elYear, elType].forEach(el => el && el.addEventListener("change", refresh));
      [elPriceFrom, elPriceTo, elSearch].forEach(el => el && el.addEventListener("input", refresh));
      [elMortgage, elPromo].forEach(el => el && el.addEventListener("change", refresh));

      load();
    })();
  </script>

</main>

<footer class="bg-slate-950 text-white mt-6">
  <div class="container-wide py-10">
    <div class="flex flex-col md:flex-row items-start justify-between gap-6">
      <div>
        <div class="text-lg font-extrabold tracking-tight">NAVI‚Ä¢ESTATE</div>
        <div class="text-white/70 text-sm mt-2">–ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∏ –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω–∞ ‚Äî —É–¥–æ–±–Ω–æ –∏ –∫—Ä–∞—Å–∏–≤–æ.</div>
      </div>
      <div class="text-white/70 text-sm">¬© 2026 ‚Ä¢ –ü–æ–ª–∏—Ç–∏–∫–∞ ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</div>
    </div>
  </div>
</footer>

</body>
</html>
